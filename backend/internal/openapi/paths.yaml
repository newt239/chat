/api/channels/{channelId}/pins:
  get:
    operationId: listPins
    summary: List pinned messages in a channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
      - name: cursor
        in: query
        required: false
        schema:
          type: string
    responses:
      "200":
        description: Pinned messages
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListPinsResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: createPin
    summary: Pin a message in a channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              messageId:
                type: string
                format: uuid
            required: [messageId]
    responses:
      "200":
        description: Pinned
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/pins/{messageId}:
  delete:
    operationId: deletePin
    summary: Unpin a message in a channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Unpinned
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
/healthz:
  get:
    operationId: healthz
    summary: Health check
    responses:
      "200":
        description: OK
        content:
          text/plain:
            schema:
              type: string
              example: ok

/api/auth/register:
  post:
    operationId: register
    summary: Register a new user
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RegisterRequest"
    responses:
      "201":
        description: User created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthResponse"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/auth/login:
  post:
    operationId: login
    summary: Login user
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/LoginRequest"
    responses:
      "200":
        description: Login successful
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/auth/refresh:
  post:
    operationId: refresh
    summary: Refresh access token
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/RefreshRequest"
    responses:
      "200":
        description: Token refreshed
        content:
          application/json:
            schema:
              type: object
              properties:
                accessToken:
                  type: string
              required:
                - accessToken
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/auth/logout:
  post:
    operationId: logout
    summary: Logout user
    security:
      - bearerAuth: []
    responses:
      "200":
        description: Logout successful
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces:
  get:
    operationId: listWorkspaces
    summary: List user workspaces
    security:
      - bearerAuth: []
    responses:
      "200":
        description: List of workspaces
        content:
          application/json:
            schema:
              type: object
              properties:
                workspaces:
                  type: array
                  items:
                    $ref: "#/components/schemas/Workspace"
              required:
                - workspaces
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: createWorkspace
    summary: Create a new workspace
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateWorkspaceRequest"
    responses:
      "201":
        description: Workspace created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Workspace"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{workspaceId}/search:
  get:
    operationId: searchWorkspace
    summary: Search workspace content
    security:
      - bearerAuth: []
    parameters:
      - name: workspaceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: q
        in: query
        required: true
        schema:
          type: string
      - name: filter
        in: query
        schema:
          type: string
          enum: [all, messages, channels, users]
      - name: page
        in: query
        schema:
          type: integer
          minimum: 1
      - name: perPage
        in: query
        schema:
          type: integer
          minimum: 1
          maximum: 50
    responses:
      "200":
        description: Search results returned successfully
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WorkspaceSearchResponse"
      "400":
        description: Invalid query parameters
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Workspace not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{id}/members:
  get:
    operationId: listMembers
    summary: List workspace members
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: List of members
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListMembersResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Workspace not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: addMember
    summary: Add member to workspace
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/AddMemberRequest"
    responses:
      "200":
        description: Member added
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MemberInfo"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{id}/members/{userId}:
  patch:
    operationId: updateMemberRole
    summary: Update member role
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UpdateMemberRoleRequest"
    responses:
      "200":
        description: Member role updated
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Member not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  delete:
    operationId: removeMember
    summary: Remove member from workspace
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Member removed
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Member not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{id}/channels:
  get:
    operationId: listChannels
    summary: List channels in workspace
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: List of channels
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/Channel"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Workspace not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: createChannel
    summary: Create a new channel
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateChannelRequest"
    responses:
      "201":
        description: Channel created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Channel"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/messages:
  get:
    operationId: listMessages
    summary: List messages in channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: limit
        in: query
        schema:
          type: integer
          default: 50
          minimum: 1
          maximum: 100
      - name: since
        in: query
        schema:
          type: string
          format: date-time
      - name: until
        in: query
        schema:
          type: string
          format: date-time
    responses:
      "200":
        description: List of messages
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessagesResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: createMessage
    summary: Create a new message
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateMessageRequest"
    responses:
      "201":
        description: Message created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Message"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/messages/with-threads:
  get:
    operationId: listMessagesWithThread
    summary: List messages in channel with thread metadata
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: limit
        in: query
        schema:
          type: integer
          default: 50
          minimum: 1
          maximum: 100
      - name: since
        in: query
        schema:
          type: string
          format: date-time
      - name: until
        in: query
        schema:
          type: string
          format: date-time
    responses:
      "200":
        description: List of messages with thread metadata
        content:
          application/json:
            schema:
              type: object
              properties:
                messages:
                  type: array
                  items:
                    allOf:
                      - $ref: "#/components/schemas/Message"
                      - type: object
                        properties:
                          threadMetadata:
                            $ref: "#/components/schemas/ThreadMetadata"
                            nullable: true
                hasMore:
                  type: boolean
              required:
                - messages
                - hasMore
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/unread_count:
  get:
    operationId: getUnreadCount
    summary: Get unread message count
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Unread count
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnreadCountResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/reads:
  post:
    operationId: updateReadState
    summary: Update channel read state
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UpdateReadStateRequest"
    responses:
      "200":
        description: Read state updated
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/attachments/presign:
  post:
    operationId: presignUpload
    summary: Get presigned upload URL
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/PresignRequest"
    responses:
      "200":
        description: Presigned URL
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PresignResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/attachments/{id}:
  get:
    operationId: getAttachment
    summary: Get attachment metadata
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Attachment metadata
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Attachment"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Attachment not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/attachments/{id}/download:
  get:
    operationId: downloadAttachment
    summary: Get presigned download URL
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Presigned download URL
        content:
          application/json:
            schema:
              type: object
              properties:
                downloadUrl:
                  type: string
                  format: uri
              required:
                - downloadUrl
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Attachment not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}/reactions:
  get:
    operationId: listReactions
    summary: List reactions for a message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: List of reactions
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListReactionsResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: addReaction
    summary: Add a reaction to a message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/AddReactionRequest"
    responses:
      "201":
        description: Reaction added
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}/reactions/{emoji}:
  delete:
    operationId: removeReaction
    summary: Remove a reaction from a message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: emoji
        in: path
        required: true
        schema:
          type: string
    responses:
      "200":
        description: Reaction removed
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Reaction not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/user-groups:
  post:
    operationId: createUserGroup
    summary: Create a new user group
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateUserGroupRequest"
    responses:
      "201":
        description: User group created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserGroup"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
  get:
    operationId: listUserGroups
    summary: List user groups
    security:
      - bearerAuth: []
    parameters:
      - name: workspace_id
        in: query
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: User groups retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                userGroups:
                  type: array
                  items:
                    $ref: "#/components/schemas/UserGroup"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/user-groups/{id}:
  get:
    operationId: getUserGroup
    summary: Get a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: User group retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserGroup"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: User group not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
  patch:
    operationId: updateUserGroup
    summary: Update a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UpdateUserGroupRequest"
    responses:
      "200":
        description: User group updated
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserGroup"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: User group not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
  delete:
    operationId: deleteUserGroup
    summary: Delete a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "204":
        description: User group deleted
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: User group not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/user-groups/{id}/members:
  post:
    operationId: addUserGroupMember
    summary: Add a member to a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/AddMemberRequest"
    responses:
      "201":
        description: Member added
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: User group not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
  get:
    operationId: listUserGroupMembers
    summary: List members of a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Members retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                members:
                  type: array
                  items:
                    $ref: "#/components/schemas/UserGroupMember"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
  delete:
    operationId: removeUserGroupMember
    summary: Remove a member from a user group
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: user_id
        in: query
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "204":
        description: Member removed
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: User group or member not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/bookmarks:
  get:
    operationId: listBookmarks
    summary: List user bookmarks
    security:
      - bearerAuth: []
    responses:
      "200":
        description: List of bookmarks
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListBookmarksResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}/bookmarks:
  post:
    operationId: addBookmark
    summary: Add bookmark to message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "201":
        description: Bookmark added
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  delete:
    operationId: removeBookmark
    summary: Remove bookmark from message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Bookmark removed
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/links/fetch-ogp:
  post:
    operationId: fetchOGP
    summary: Fetch OGP data for a URL
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/FetchOGPRequest"
    responses:
      "200":
        description: OGP data retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FetchOGPResponse"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}/thread:
  get:
    operationId: getThreadReplies
    summary: Get thread replies for a message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: limit
        in: query
        schema:
          type: integer
          default: 50
          minimum: 1
          maximum: 100
    responses:
      "200":
        description: Thread replies retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ThreadRepliesResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}/thread/metadata:
  get:
    operationId: getThreadMetadata
    summary: Get thread metadata for a message
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Thread metadata retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ThreadMetadata"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message or metadata not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/messages/{messageId}:
  patch:
    operationId: updateMessage
    summary: Update a message
    description: Updates a message body (author or admin only)
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UpdateMessageRequest"
    responses:
      "200":
        description: Message updated successfully
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Message"
      "400":
        description: Bad request or message already deleted
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden - not message author or admin
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "500":
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  delete:
    operationId: deleteMessage
    summary: Delete a message
    description: Deletes a message (author or admin only)
    security:
      - bearerAuth: []
    parameters:
      - name: messageId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "204":
        description: Message deleted successfully
      "400":
        description: Bad request or message already deleted
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden - not message author or admin
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Message not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "500":
        description: Internal server error
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/members:
  get:
    operationId: listChannelMembers
    summary: List channel members
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: List of channel members
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListChannelMembersResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: inviteChannelMember
    summary: Invite member to channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/InviteChannelMemberRequest"
    responses:
      "200":
        description: Member invited
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuccessResponse"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel or user not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "409":
        description: Already a member
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/members/self:
  post:
    operationId: joinPublicChannel
    summary: Join public channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Joined channel
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuccessResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Channel is private
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  delete:
    operationId: leaveChannel
    summary: Leave channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Left channel
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuccessResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "409":
        description: Cannot leave - last admin
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/members/{userId}/role:
  patch:
    operationId: updateChannelMemberRole
    summary: Update channel member role
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UpdateChannelMemberRoleRequest"
    responses:
      "200":
        description: Member role updated
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuccessResponse"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel or member not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "409":
        description: Cannot update - last admin
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/channels/{channelId}/members/{userId}:
  delete:
    operationId: removeChannelMember
    summary: Remove member from channel
    security:
      - bearerAuth: []
    parameters:
      - name: channelId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: Member removed
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SuccessResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "403":
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "404":
        description: Channel or member not found
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "409":
        description: Cannot remove - last admin
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{id}/dms:
  get:
    operationId: listDMs
    summary: List DMs in workspace
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "200":
        description: List of DMs
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/DMOutput"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  post:
    operationId: createDM
    summary: Create a 1:1 DM
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateDMRequest"
    responses:
      "200":
        description: DM created or retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DMOutput"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{id}/group-dms:
  post:
    operationId: createGroupDM
    summary: Create a group DM
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/CreateGroupDMRequest"
    responses:
      "200":
        description: Group DM created or retrieved
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DMOutput"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/workspaces/{workspaceId}/threads/participating:
  get:
    operationId: getParticipatingThreads
    summary: Get participating threads
    security:
      - bearerAuth: []
    parameters:
      - name: workspaceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: cursorLastActivityAt
        in: query
        required: false
        schema:
          type: string
          format: date-time
      - name: cursorThreadId
        in: query
        required: false
        schema:
          type: string
          format: uuid
      - name: limit
        in: query
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
    responses:
      "200":
        description: List of participating threads
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ParticipatingThreadsOutput"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

/api/threads/{threadId}/read:
  post:
    operationId: markThreadRead
    summary: Mark thread as read
    security:
      - bearerAuth: []
    parameters:
      - name: threadId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    responses:
      "204":
        description: Thread marked as read
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"
