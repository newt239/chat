{
    email {{ caddy_email | default('contact@newt239.dev') }}
}

{{ domain | default('chat.newt239.dev') }} {
    # バックエンドAPIへのリバースプロキシ
    handle /api/* {
        reverse_proxy backend:8080
    }

    # WebSocketへのリバースプロキシ
    handle /ws {
        reverse_proxy backend:8080
    }

    # フロントエンドへのリバースプロキシ
    handle {
        reverse_proxy frontend:80
    }

    # ログ設定（stdoutに出力）
    log {
        output stdout
        format json
    }

    # セキュリティヘッダー
    header {
        # XSS保護を有効化
        X-XSS-Protection "1; mode=block"
        # コンテンツタイプスニッフィング防止
        X-Content-Type-Options "nosniff"
        # クリックジャッキング防止
        X-Frame-Options "SAMEORIGIN"
        # HTTPSへの自動アップグレード
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }

    # Gzip圧縮を有効化
    encode gzip
}

